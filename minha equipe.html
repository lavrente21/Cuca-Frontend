<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuca - Minha Equipe</title>
    <link rel="stylesheet" href="/css/style.css"> 
    
</head>
<body>

    <div class="app-container">
        
        <header class="investment-header">
            <a href="Pagina inicial.html" class="back-icon">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/>
                </svg>
            </a>
            <h1>Minha equipe</h1>
        </header>

        <section class="hero-section">
            <p class="illustration-text">Múltiplos benefícios esperando por você para receber</p>
            <svg class="hero-illustration-svg" viewBox="0 0 400 150">
                <rect x="50" y="80" width="300" height="70" rx="10" fill="#FFC72C"/>
                <circle cx="100" cy="70" r="20" fill="#B32C1A"/>
                <circle cx="150" cy="60" r="25" fill="#FFC72C"/>
                <circle cx="200" cy="50" r="30" fill="#B32C1A"/>
                <circle cx="250" cy="60" r="25" fill="#FFC72C"/>
                <circle cx="300" cy="70" r="20" fill="#B32C1A"/>

                <circle cx="70" cy="50" r="15" fill="#5cb85c"/> 
                <rect x="65" y="60" width="10" height="30" fill="#4CAF50"/> 
                <circle cx="70" cy="50" r="5" fill="#F0F0F0"/> 
                <polygon points="60,45 80,45 70,30" fill="#FFC72C"/> 

                <circle cx="330" cy="50" r="15" fill="#b32c1a"/> 
                <rect x="325" y="60" width="10" height="30" fill="#E64A19"/> 
                <circle cx="330" cy="50" r="5" fill="#F0F0F0"/> 
                <polygon points="320,45 340,45 330,30" fill="#FFC72C"/> 

                <rect x="180" y="100" width="40" height="30" rx="5" fill="#8B4513"/>
                <circle cx="200" cy="95" r="15" fill="#FFC72C"/>
                <circle cx="210" cy="90" r="10" fill="#B32C1A"/>
            </svg>
        </section>

        <section class="invitation-section">
            <svg class="invitation-icon" viewBox="0 0 24 24">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"/>
            </svg>
            <div class="invitation-details">
                <p>Link de Convite</p>
                <a href="#" id="invitation-link-text">Aperte em copiar</a><br>
                <button class="copy-button" onclick="copyInvitationLink()">Copiar</button>
            </div>
        </section>

        <input type="text" id="hidden-invitation-link" style="position: absolute; left: -9999px;">

        <section class="team-levels-container">
            <br><div class="team-level-header"> 
                <h2>Nível da Equipe</h2>
            </div>

            <div class="team-level-card">
                <div class="team-level-header">
                    <h2>Nível 1</h2>
                    <svg class="team-level-icon" viewBox="0 0 24 24">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.72-7 8.94V12H5V6.3l7-3.11v8.8z" fill="currentColor"/>
                    </svg>
                </div>
                <div class="team-stats">
                    <div class="stat-item">
                        <span class="value" id="nivel1-total">0</span>
                        <span class="label">Total de convites</span>
                    </div>
                    <div class="stat-item">
                        <span class="value" id="nivel1-ativos">0</span>
                        <span class="label">Ativos</span>
                    </div>
                </div>
            </div>

            <div class="team-level-card">
                <div class="team-level-header">
                    <h2>Nível 2</h2>
                    <svg class="team-level-icon" viewBox="0 0 24 24">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.72-7 8.94V12H5V6.3l7-3.11v8.8z" fill="currentColor"/>
                    </svg>
                </div>
                <div class="team-stats">
                    <div class="stat-item">
                        <span class="value" id="nivel2-total">0</span>
                        <span class="label">Total de convites</span>
                    </div>
                    <div class="stat-item">
                        <span class="value" id="nivel2-ativos">0</span>
                        <span class="label">Ativos</span>
                    </div>
                </div>
            </div>

            <div class="team-level-card">
                <div class="team-level-header">
                    <h2>Nível 3</h2>
                    <svg class="team-level-icon" viewBox="0 0 24 24">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.72-7 8.94V12H5V6.3l7-3.11v8.8z" fill="currentColor"/>
                    </svg>
                </div>
                <div class="team-stats">
                    <div class="stat-item">
                        <span class="value" id="nivel3-total">0</span>
                        <span class="label">Total de convites</span>
                    </div>
                    <div class="stat-item">
                        <span class="value" id="nivel3-ativos">0</span>
                        <span class="label">Ativos</span>
                    </div>
                </div>
            </div>
        </section>

        <nav class="bottom-nav">
            <a href="Pagina inicial.html" class="nav-item">
                <svg viewBox="0 0 24 24" class="bottom-icon">
                    <path d="M12 2L3 9v12h18V9L12 2zm0 16c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                </svg>
                <span>Início</span>
            </a>
            <a href="lista de investimento.html" class="nav-item">
                <svg viewBox="0 0 24 24" class="bottom-icon">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 16c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm-1-8H9V8h2v2h2v2h-2z"/>
                </svg>
                <span>Investir</span>
            </a>
            <a href="#" class="nav-item">
                <svg viewBox="0 0 24 24" class="bottom-icon">
                    <path d="M12 2c-4.97 0-9 4.03-9 9 0 4.25 3.14 7.6 7.23 8.36L12 20l1.77-1.64C17.86 18.6 21 15.25 21 11c0-4.97-4.03-9-9-9zm-1 16.5V11h2v7.5h-2zM12 6c-2.21 0-4 1.79-4 4h8c0-2.21-1.79-4-4-4z"/>
                </svg>
                <span>Tarefas</span>
            </a>
            <a href="blog.html" class="nav-item active">
                <svg viewBox="0 0 24 24" class="bottom-icon">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7 7h10v2H7V7zm10 4H7v2h10v-2zm0 4H7v2h10v-2z"/>
                </svg>
                <span>Blog</span>
            </a>
            <a href="minha conta.html" class="nav-item">
                <svg viewBox="0 0 24 24" class="bottom-icon">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.93 0 3.5 1.57 3.5 3.5S13.93 12 12 12s-3.5-1.57-3.5-3.5S10.07 5 12 5zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08s5.97 1.09 6 3.08c-1.29 1.94-3.5 3.22-6 3.22z"/>
                </svg>
                <span>Conta</span>
            </a>
        </nav>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const userId = localStorage.getItem('referral_code') || localStorage.getItem('username'); 
        const baseUrl = 'https://cucainvest.netlify.app/registro.html?invitation_code=';
        const invitationLink = baseUrl + userId;

        document.getElementById('hidden-invitation-link').value = invitationLink;
        const linkText = document.getElementById('invitation-link-text');
        linkText.textContent = invitationLink;
        linkText.href = invitationLink;

        const token = localStorage.getItem('userToken'); 
        if (!token) {
            window.location.href = "login.html";
            return;
        }

        try {
            const res = await fetch("https://cuca-project-5.onrender.com/api/team/stats", {
                headers: { Authorization: `Bearer ${token}` }
            });
            const data = await res.json();

            document.querySelector("#nivel1-total").textContent = data.nivel1.total;
            document.querySelector("#nivel1-ativos").textContent = data.nivel1.ativos;

            document.querySelector("#nivel2-total").textContent = data.nivel2.total;
            document.querySelector("#nivel2-ativos").textContent = data.nivel2.ativos;

            document.querySelector("#nivel3-total").textContent = data.nivel3.total;
            document.querySelector("#nivel3-ativos").textContent = data.nivel3.ativos;

        } catch (err) {
            console.error("❌ Erro ao carregar estatísticas da equipe:", err);
        }
    });

    function copyInvitationLink() {
        const hiddenInput = document.getElementById('hidden-invitation-link');
        if (hiddenInput && hiddenInput.value) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(hiddenInput.value).then(() => {
                    alert('Link de convite copiado!');
                }).catch(err => {
                    console.error('Falha ao copiar usando a API de Clipboard: ', err);
                    copyFallback(hiddenInput);
                });
            } else {
                copyFallback(hiddenInput);
            }
        }
    }

    function copyFallback(element) {
        element.select();
        element.setSelectionRange(0, 99999); 
        try {
            document.execCommand('copy');
            alert('Link de convite copiado!');
        } catch (err) {
            console.error('Falha ao copiar o link.', err);
        }
    }
</script>

</body>
</html>
